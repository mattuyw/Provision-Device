---
- name: Check if warp is installed in global Applications
  stat:
    path: /Applications/Warp.app
  register: warp_installed
  failed_when: not warp_installed.stat.exists

# - name: Fetch current LSHandlers
#   command: defaults read com.apple.LaunchServices/com.apple.launchservices.secure LSHandlers
#   register: lshandlers
#   changed_when: false
#   ignore_errors: true
#
# - name: Backup the current LSHandlers
#   copy:
#     content: "{{ lshandlers.stdout }}"
#     dest: "~/LSHandlers.backup.plist"
#     mode: '0644'
#   when: lshandlers.stdout != ""
#
# - name: Set warp as the default for .terminal files
#   block:
#     - name: Set warp as the default for .terminal files
#       command: "defaults write com.apple.LaunchServices/com.apple.launchservices.secure LSHandlers -array-add '{LSHandlerContentType=com.apple.terminal;LSHandlerRoleAll=dev.warp.Warp-Stable;}'"
#   rescue:
#     - name: Revert LSHandlers from backup
#       command: "defaults import com.apple.LaunchServices/com.apple.launchservices.secure ~/LSHandlers.backup.plist"
#
# - name: Restart the Launch Services Database
#   command: /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -kill -r -domain local -domain system -domain user
#   become: true
